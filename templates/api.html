
<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>云之家js桥demo</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<style>
		html,body,div,ul,li,h3,p,a{
			margin:0; 
			padding:0;
		}
		body{
			line-height: 1.6;
		}
		ul{
			list-style: none;
		}
		a{
			text-decoration: none;
		}
		.yzjapi-list{
			width: 100%;
			background-color: #fff;
		}
		.api-item{
			padding-left: 15px;
		}
		.api-item a{
			display: block;
			color: #3e3e3e;
			-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
		}
		.api-item-inner{
			padding-top: 10px;
			padding-bottom: 10px;
			min-height: 24px;
			position: relative;
		}
		.api-item-inner:before{
			content: " ";
			position: absolute;
			left: 0;
			top: 0;
			width: 200%;
			height: 1px;
			border-top: 1px solid #ededed;
			-webkit-transform-origin: 0 0;
			transform-origin: 0 0;
			-webkit-transform: scale(0.5);
			transform: scale(0.5);
			top: auto;
			bottom: -2px;
		}
		h3{
			padding-top: 16px;
			margin-top: 25px;
			font-size: 16px;
			font-weight: 400;
			color: #3e3e3e;
			position: relative;
		}
		h3:first-child{
		    padding-top: 15px;
		}
		.desc {
		    font-size: 14px;
		    font-weight: 400;
		    line-height: 2em;
		    color: #8d8c92;
		}
		.btn{
			display: block;
			margin-left: auto;
			margin-right: auto;
			padding-left: 14px;
			padding-right: 14px;
			font-size: 18px;
			text-align: center;
			text-decoration: none;
			overflow: visible;
			height: 42px;
			border-radius: 5px;
			-moz-border-radius: 5px;
			-webkit-border-radius: 5px;
			box-sizing: border-box;
			-moz-box-sizing: border-box;
			-webkit-box-sizing: border-box;
			color: #ffffff;
			line-height: 42px;
			-webkit-tap-highlight-color: rgba(255, 255, 255, 0);
			background-color: #3cbaff;
		}
		button.btn {
		    width: 100%;
		    border: 0;
		    outline: 0;
		    -webkit-appearance: none;
		}
		.yzjapi-test{
			background-color: #ffffff;
		    padding: 0 15px;
		    margin-top: 30px;
		    padding-bottom: 15px;
		}
	</style>
</head>
<body>
	<ul class="yzjapi-list">
		<li class="api-item"><a class="api-item-inner" href="#menu-base">基础接口</a></li>
		<!-- <li class="api-item"><a class="api-item-inner" href="#menu-option">隐藏或者显示右上角的按钮</a></li> -->
		<li class="api-item"><a class="api-item-inner" href="#title">隐藏或者设置页面标题</a></li>
		<li class="api-item"><a class="api-item-inner" href="#getPersonInfo-title">获取当前用户身份信息（桌面端+）</a></li>
		<li class="api-item"><a class="api-item-inner" href="#network">获取用户网络状态</a></li>
		<li class="api-item"><a class="api-item-inner" href="#third">打开第三方应用</a></li>
		<li class="api-item"><a class="api-item-inner" href="#menu-chat">进入会话</a></li>
		<li class="api-item"><a class="api-item-inner" href="#personInfo-title">唤起人员详情页面</a></li>
		<li class="api-item"><a class="api-item-inner" href="#menu-share">分享接口</a></li>
		<li class="api-item"><a class="api-item-inner" href="#switchCompany-title">切换工作圈</a></li>
		<li class="api-item"><a class="api-item-inner" href="#menu-view-control">关闭轻应用界面</a></li>
		<li class="api-item"><a class="api-item-inner" href="#scanQRCode-title">扫一扫</a></li>
		<li class="api-item"><a class="api-item-inner" href="#createPop-title">自定义右上角弹出菜单</a></li>
		<li class="api-item"><a class="api-item-inner" href="#closePop-title">关闭右上角弹出菜单</a></li>
		<li class="api-item"><a class="api-item-inner" href="#closeWebView-title">关闭当前webview</a></li>
		<li class="api-item"><a class="api-item-inner" href="#getLocation-title">云之家定位</a></li>
		<li class="api-item"><a class="api-item-inner" href="#selectLocation-title">云之家选取周边位置</a></li>
	</ul>
	<div class="yzjapi-test">
		<h3 id="menu-base">基础接口</h3>
		<p class="desc">判断当前手机系统的类型</p>
		<button class="btn" id="getOS">getOS</button>
		<p class="desc">判断当前手机环境是否支持JSBridge</p>
		<button class="btn" id="supportBridge">support</button>
		<p class="desc">当前支持的js桥的版本</p>
		<button class="btn" id="getVersion">getVersion</button>
		<p class="desc">判断是否运行于云之家桌面端</p>
		<button class="btn" id="getCloudhub">getCloudhub</button>

		<!-- <h3 id="menu-option">隐藏或者显示右上角的按钮</h3>
		<p class="desc">隐藏右上角按钮</p>
		<button class="btn" id="hideOptionMenu">hideOptionMenu</button>
		<p class="desc">显示右上角按钮</p>
		<button class="btn" id="showOptionMenu">showOptionMenu</button> -->

		<h3 id="title">隐藏或者设置页面标题</h3>
		<p class="desc">隐藏页面标题</p>
		<button class="btn" id="hideWebViewTitle">hideWebViewTitle</button>
		<p class="desc">设置页面标题并显示</p>
		<button class="btn" id="setWebViewTitle">setWebViewTitle</button>

		<h3 id="getPersonInfo-title">获取当前用户身份信息（桌面端+）</h3>
		<p class="desc">获取当前用户身份信息（桌面端+）</p>
		<button class="btn" id="getPersonInfo">getPersonInfo</button>

		<h3 id="network">获取用户网络状态</h3>
		<p class="desc">获取用户网络状态</p>
		<button class="btn" id="getNetworkType">getNetworkType</button>

		<h3 id="third">打开第三方应用</h3>
		<p class="desc">打开第三方应用</p>
		<button class="btn" id="gotoApp">gotoApp</button>

		<h3 id="menu-chat">进入会话</h3>
		<p class="desc">进入会话</p>
		<button class="btn" id="chat">chat</button>

		<h3 id="personInfo-title">唤起人员详情页面</h3>
		<p class="desc">唤起人员详情页面</p>
		<button class="btn" id="personInfo">personInfo</button>

		<h3 id="menu-share">分享接口</h3>
		<p class="desc">公共号或轻应用分享消息（桌面端+）
		</p><button class="btn" id="share-pub">share</button>

		<h3 id="switchCompany-title">切换工作圈</h3>
		<p class="desc">切换工作圈</p>
		<button class="btn" id="switchCompany">switchCompany</button>

		<h3 id="menu-view-control">关闭轻应用界面</h3>
		<p class="desc">关闭轻应用界面</p>
		<button class="btn" id="close">close</button>

		<h3 id="selectPic-title">获取图片</h3>
		<p class="desc">获取图片</p>
		<button class="btn" id="selectPic">selectPic</button>

		<h3 id="scanQRCode-title">扫一扫</h3>
		<p class="desc">扫一扫</p>
		<button class="btn" id="scanQRCode">scanQRCode</button>

		<h3 id="createPop-title">自定义右上角弹出菜单</h3>
		<p class="desc">自定义右上角弹出菜单</p>
		<button class="btn" id="createPop">createPop</button>
		
		<h3 id="closePop-title">关闭右上角弹出菜单</h3>
		<p class="desc">关闭右上角弹出菜单</p>
		<button class="btn" id="closePop">closePop</button>

		<h3 id="closeWebView-title">关闭当前webview</h3>
		<p class="desc">关闭当前webview</p>
		<button class="btn" id="closeWebView">closeWebView</button>

		<h3 id="getLocation-title">云之家定位</h3>
		<p class="desc">云之家定位</p>
		<button class="btn" id="getLocation">getLocation</button>

		<h3 id="selectLocation-title">云之家选取周边位置</h3>
		<p class="desc">云之家选取周边位置</p>
		<button class="btn" id="selectLocation">selectLocation</button>
		
		<h3 id="selectLocation-title">选择人员</h3>
        <p class="desc">选择人员</p>
        <button class="btn" id="selectPersons">selectPersons</button>
	</div>

	<script src="http://im.kdweibo.com/pub/js/qingjs.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
		var openId = '',
		wbuserid = '',
		XuntongJSBridge = window.XuntongJSBridge;

	function getOS() {
		return (navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/) ? 'iOS' :
			navigator.userAgent.match(/Android/i) ? 'Android' : '');
	}

	/* 判断是否运行于云之家桌面端
	 * @return {object} cloudhub 返回是否桌面端、当前桌面端userAgent版本及是否支持js桥
	 * cloudhub = {isCloudHub: true | false, hasJsBridget: true | false, version: '0.0.1'}
	 */

	function getCloudHub() {
		var ua = window.navigator.userAgent;
		var reg = /cloudhub 10204\/([^;]+)/;
		var cloudhub = {
			isCloudHub: false,
			hasJsBridget: false,
			version: ''
		};

		var match = reg.exec(ua),
			version;

		if (match) {
			version = match[1];
			cloudhub.isCloudHub = true;
			cloudhub.version = version;

			if (version.replace(/\./g, '') > 1) {
				cloudhub.hasJsBridget = true;
			}
		}

		return cloudhub;
	}

	function callback(result) {
		var success;
		/* ****  注意 start **** */
		/* ****  由于在桌面端，实现js桥方式不同，这里的回调返回值result是一个string **** */
		/* ****  为确保result正常使用，建议在回调中添加如下代码 **** */
		if (typeof result == 'string') {
			result = JSON.parse(result);
		}
		success = String(result.success);
		if (success == "true") {

		} else {

		}

		alert("结果：" + JSON.stringify(result));
	}

	if (getOS() === '' || navigator.userAgent.indexOf('Qing') === -1) {
		var bodyEle = document.getElementsByTagName('body')[0];
		if (document.addEventListener) {
			bodyEle.addEventListener('click', function(e) {
				if (e && e.target && e.target.tagName.toLowerCase() === 'button') {
					alert('请在云之家中打开链接体验。');
				}
			}, false);
		} else if (document.attachEvent) {
			bodyEle.attachEvent('onclick', function(e) {
				if (e && e.target && e.target.tagName.toLowerCase() === 'button') {
					alert('请在云之家中打开链接体验。');
				}
			}, false);
		}
		return;
	}

	XuntongJSBridge.call('getPersonInfo', {}, function(result) {
		if (result.success) {
			openId = result.data.openId;
			wbuserid = result.data.wbuserid;
		}
	});

	//获取当前的用户环境是否ios或Android或非手机
	document.querySelector('#getOS').onclick = function() {
		var ret = getOS();
		if (ret === '') {
			ret = 'other';
		}
		alert(ret);
	};
	//判断当前环境是否支持JSBridge
	document.querySelector('#supportBridge').onclick = function() {
		alert(navigator.userAgent.indexOf('Qing') >= 0);
	};
	//当前支持的js桥的版本
	document.querySelector('#getVersion').onclick = function() {
		var ua = navigator.userAgent,
			reg = /Qing\/([^;]+)/gi,
			version = '不支持js桥',
			match = reg.exec(ua);

		if (match && match.length >= 2) {

			version = match[1];
		}
		alert(version);
	};
	//判断是否运行于云之家桌面端
	document.querySelector('#getCloudhub').onclick = function() {
		var cloudHub = getCloudHub();
		alert("结果：" + JSON.stringify(cloudHub));
	};

	//隐藏右上角按钮
	// document.querySelector('#hideOptionMenu').onclick = function() {
	// 	XuntongJSBridge.call('hideOptionMenu');
	// };
	//显示右上角按钮
	// document.querySelector('#showOptionMenu').onclick = function() {
	// 	XuntongJSBridge.call('showOptionMenu');
	// };

	//隐藏页面标题
	document.querySelector('#hideWebViewTitle').onclick = function() {
		XuntongJSBridge.call('hideWebViewTitle');
	};
	//设置页面标题并显示
	document.querySelector('#setWebViewTitle').onclick = function() {
		XuntongJSBridge.call('setWebViewTitle', {
			'title': '你设置的标题'
		});
	};

	//获取当前用户身份信息（桌面端+）
	document.querySelector('#getPersonInfo').onclick = function() {
		XuntongJSBridge.call('getPersonInfo', {}, function(result) {
			callback(result);
		});
	};

	//获取用户网络状态
	document.querySelector('#getNetworkType').onclick = function() {
		XuntongJSBridge.call('getNetworkType', {}, function(result) {
			callback(result);
		});
	};

	//打开第三方应用
	document.querySelector('#gotoApp').onclick = function() {
		XuntongJSBridge.call('gotoApp', {
			"data": 'kdweibo://p?url=https://itunes.apple.com/cn/app/bu-luo/id946626039'
		}, function(result) {
			callback(result);
		});
	};

	//进入会话
	document.querySelector('#chat').onclick = function() {
		alert('XT-' + wbuserid + '-XT-10000')
		XuntongJSBridge.call('chat', {
			//openId或者groupId
			'openId': 'XT-' + wbuserid + '-XT-10000'
		}, function(result) {
			alert("结果：" + JSON.stringify(result));
		});
	};

	// 唤起人员详情页面
	document.querySelector('#personInfo').onclick = function() {
		XuntongJSBridge.call('personInfo', {
			'openId': openId
		}, function(result) {
			callback(result);
		});
	};

	//分享接口
	document.querySelector('#share-pub').onclick = function() {
		XuntongJSBridge.call("share", {
			"shareType": "4",
			"appId": "XT-9105d076-f022-4c57-8631-6c859624d602",
			"appName": "测试",
			"theme": "组名",
			"title": "分享的标题",
			"content": "分享的内容",
			"thumbData": testImg,
			"webpageUrl": "http://baidu.com",
			"cellContent": "聊天界面显示的内容",
			"sharedObject": "all"
		}, function(result) {
			callback(result);
		});
	};

	// 切换工作圈
	document.querySelector('#switchCompany').onclick = function() {
		XuntongJSBridge.call("switchCompany", {
			"eid": "1746898"
		}, function(result) {
			callback(result);
		});
	};

	// 关闭轻应用界面
	document.querySelector('#close').onclick = function() {
		XuntongJSBridge.call('close');
	};

	// 获取图片
	document.querySelector('#selectPic').onclick = function() {
		XuntongJSBridge.call('selectPic', {}, function(result) {
			alert("结果：" + JSON.stringify(result.success) + '。由于图片编码过长，具体返回，请查看文档。');
		});
	};

	// 扫一扫
	document.querySelector('#scanQRCode').onclick = function() {
		XuntongJSBridge.call("scanQRCode", {
			"needResult": 0
		}, function(result) {
			callback(result);
		});
	};
	//自定义右上角弹出菜单
	document.querySelector('#createPop').onclick = function() {
		XuntongJSBridge.call('createPop', {
			'popTitle': '测试标题',
			'popTitleCallBackId': '弹出菜单的ID',
			'items': [{
				'text': '测试',
				'callBackId': '测试项的单项ID'
			}],
			'menuList': ['refresh', 'share', 'openWithBrowser']
		}, function(result) {
			alert("结果：" + JSON.stringify(result));
		});
	};
	//关闭右上角弹出菜单
	document.querySelector('#closePop').onclick = function() {
		XuntongJSBridge.call('closePop');
	};

	// 关闭当前webview
	document.querySelector('#closeWebView').onclick = function() {
		XuntongJSBridge.call('closeWebView');
	};

		// 云之家定位
	document.querySelector('#getLocation').onclick = function() {
		XuntongJSBridge.call('getLocation', {}, function(result) {
			alert("结果：" + JSON.stringify(result));
		});
	};
	// 云之家选取周边位置
	document.querySelector('#selectLocation').onclick = function() {
		XuntongJSBridge.call('selectLocation', {
				'isLocation': true
			},
			function(result) {
				alert("结果：" + JSON.stringify(result));
			}
		);
	};
	
	// 云之家选取周边位置
    document.querySelector('#selectPersons').onclick = function() {
        XuntongJSBridge.call('selectPersons', {
                'isMulti':false
            },
            function(result) {
                alert("结果：" + JSON.stringify(result));
            }
        );
    };
});
	</script>


</body>
</html>